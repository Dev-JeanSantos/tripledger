# ADR-004 — Hexagonal Enforcement Rules

> [Portuguese version](../pt/ADR-004.md)

## Status
Accepted

## Date
2026-02-22

## Context

TripLedger uses Hexagonal Architecture. Enforcement rules are needed to:

- Maintain clean boundaries
- Avoid coupling between modules
- Ensure domain purity
- Serve as a reference for AI-assisted code generation

---

## Decision

1. **Domain Layer**
   - No framework dependencies
   - Contains entities, value objects, exceptions, domain services
   - Contains all business rules

2. **Application Layer**
   - Defines input/output ports
   - Implements use cases
   - Coordinates domain operations
   - May contain DTOs

3. **Adapter Layer**
   - Implements ports
   - REST controllers (input)
   - Mongo repositories (output)
   - External API integrations
   - No business rules here

4. **Inter-Module Communication**
   - Must go through Ports only
   - No module accesses another module’s adapters or domain directly

5. **Testing**
   - Domain: unit tests only
   - Use cases: unit/integration tests using Ports
   - Adapters: integration tests with DB

---

## Rationale

Enforcing Hexagonal boundaries ensures:

- Clean separation of concerns
- Easier maintainability
- Future extraction to microservices
- AI-generated code follows architectural discipline

---

## Consequences

- Clear module ownership
- Minimal accidental coupling
- Maintainable, testable, and extendable code

